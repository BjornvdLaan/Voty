{% load i18n %}
{% load get_as_string %}
{% load get_attr %}
<div class="container">
  <div class="row">
    <div class="col">
      <a href="{% url 'policy_item' policy_id=policy.id %}" class="go-to-index"><i class="material-icons chevron-left">chevron_left</i><span>{% trans "Return to Policy" %}</span></a>
    </div>
  </div>
  <div class="row">
    <h1 class="display-4">{% trans "Version history: Policy" %} #{{policy.id}}</h1>
  </div>
  <div class="row">
    <div class="col-md-6">
      <h6 class="text-muted classification">{% trans "Compare version" %}</h6>
      <div class="voty-dropdown dropdown">
        <a id="versionSelectDropdown" href="#" class="dropdown-toggle" data-toggle="dropdown" aria-has-popup="true" aria-expanded="false">
          {% if selected.revision.user %}{% include "fragments/avatar.html" with size=25 user=selected.revision.user %}{% endif %}<strong>{{ selected.revision.date_created }}</strong>
        </a>
        <br />{% if selected.revision.comment %}<em>{{selected.revision.comment}}</em>{% endif %}
        <div class="dropdown-menu dropdown-menu-right voty-modification-dropdown-menu" aria-labelledby="versionSelectDropdown">
          {% for v in policy.versions %}
            {% if v == latest %}
            {% else %}
              <div>
                <a data-ajax="true" href="{% url 'policy_history' policy_id=policy.id slug=policy.slug version_id=v.id %}" class="dropdown-item voty-modification-dropdown-item">
                  {% if v == selected %}<strong>{%endif%}
                  {% if v.revision.user %}{% include "fragments/avatar.html" with size=25 user=v.revision.user %}{% endif %} {{v.revision.date_created}}
                  {% if v == selected %}</strong>{%endif%}
                </a>
                {% if request.guard.policy_history_delete %}
                  {% if v.revision.user.id == request.user.id %}
                    <a data-ajax="true" href="{% url 'policy_history_delete' policy_id=policy.id slug=policy.slug version_id=v.id %}" class="voty-modification-dropdown-delete"><i class="material-icons delete_outline">delete_outline</i></a>
                  {% endif %}
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}
        </div>
      </div> 
  
    </div>
    <div class="col-md-6">
      <h6 class="text-muted classification">{% trans "with current version" %}</h6>
      <div>
        {% if latest.revision.user %}{% include "fragments/avatar.html" with size=25 user=latest.revision.user %}{% endif %}<strong>{{latest.revision.date_created}}</strong>
        <br />{% if latest.revision.comment %}<em>{{latest.revision.comment}}</em>{% endif %}
      </div>
    </div>
  </div>

  <hr/>
  {% include "initproc/blocks/meta.html" with initiative=compare %}
  <hr/>

  <div class="voty-modification container">
    <div class="row initiative-text">
      <div class="col-12">
        {% for field_title in policy_fields %}
          <h2>{{ policy_labels|get_attr:field_title }}</h2>
          {{ compare|get_attr:field_title }}
        {% endfor %}
      </div>
  </div>
</div>

