{% extends "_base.html" %}

{% load avatar_tags %}

{% block content %}
<form id="filters" method="GET">
	<div class="typefilter">
		<div class="container-fluid">
			<div class="row no-gutters">
				<div class="col-auto">
			      <h6>
			      	Zeige nur:
			      </h6>
	    		</div>
	    		<div class="col-sm-10">
				  	<div class="row no-gutters">
					 	{% if inbox_count %}
					    <div class="col-auto">
						    <label>
						      	<input name="f" value="i" type="checkbox" {% if 'i' in filters %} checked{% endif %}>
						      	<span class="badge badge-arrivals">
						      		Neu eingegangen ({{inbox_count}})
						      	</span>
						    </label>
						</div>
				      	{% endif %}
				      	<div class="col-auto">
						    <label>
						      	<input name="f" value="s" type="checkbox" {% if 's' in filters %} checked{% endif %}>
						      	<span class="badge badge-support">
						      		Sucht Unterstützung
						      	</span>
						    </label>
						</div>
						<div class="col-auto">
						    <label>
						      	<input name="f" value="d" type="checkbox" {% if 'd' in filters %} checked{% endif %}>
						      	<span class="badge badge-discussion">
						      		In Diskussion
						      	</span>
						    </label>
						</div>
						<div class="col-auto">
						    <label>
						      	<input name="f" value="e" type="checkbox" {% if 'e' in filters %} checked{% endif %}>
						      	<span class="badge badge-edits">
						      		Finale Überarbeitung
						      	</span>
						    </label>
						</div>
						<div class="col-auto">
						    <label>
						      	<input name="f" value="v" type="checkbox" {% if 'v' in filters %} checked{% endif %}>
						      	<span class="badge badge-vote">
						      		Abstimmung
						      	</span>
						    </label>
						</div>
						<div class="col-auto">
						    <label>
						      	<input name="f" value="a" type="checkbox" {% if 'a' in filters %} checked{% endif %}>
						      	<span class="badge badge-accepted">
						      		Angenommen
						      	</span>
						    </label>
						</div>
						<div class="col-auto">
						    <label>
						      	<input name="f" value="r" type="checkbox" {% if 'r' in filters %} checked{% endif %}>
						      	<span class="badge badge-rejected">
						      		Abgelehnt
						      	</span>
						    </label>
						</div>
					</div>
				</div>
			</div>
		</div>
    </div>
 </form>

<div class="container init-index">
	{% for init in initiatives %}
	<div class="card">
		<div class="card-header">
			<div class="container-fluid">
				 <div class="row no-gutters">
				 	<div class="col-auto align-self-center">
				  		{% ifequal init.state 'i' %}
						<span class="badge badge-arrivals">
							Neu eingegangen
						</span>
						{% endifequal %}

						{% ifequal init.state 's' %}
						<span class="badge badge-support">
							Sucht Unterstützung
						</span>
						{% endifequal %}

						{% ifequal init.state 'd' %}
						<span class="badge badge-discussion">
							In Diskussion
						</span>
						{% endifequal %}

						{% ifequal init.state 'e' %}
						<span class="badge badge-edits">
							Finale Überarbeitung
						</span>
						{% endifequal %}

						{% ifequal init.state 'v' %}
						<span class="badge badge-vote">
							Abstimmung
						</span>
						{% endifequal %}

						{% ifequal init.state 'a' %}
						<span class="badge badge-accepted">
							Angenommen
						</span>
						{% endifequal %}

						{% ifequal init.state 'r' %}
						<span class="badge badge-rejected">
							Abgelehnt
						</span>
						{% endifequal %}
					</div>
					<div class="col text-right align-self-center">
						<span class="text-muted align-middle">
							Noch {{init.end_of_this_phase | timeuntil}}
						</span>
					</div>
				</div>
			</div>
		</div>
		<div class="card-block">
	    	<h4 class="card-title init-title">
	    		<a href="/initiative/{{init.id}}">
					{{init.title}}
				</a>
			</h4>
	    	<p class="card-text">
	    		{{init.summary}}
	    	</p>
	  	</div>
	  	<div class="card-footer">
	  		<div class="container-fluid">
				 <div class="row no-gutters">
				 	<div class="col align-self-center">
				 		<a href="#">
				 			Teilen
				 		</a>
				 	</div>
				 	<div class="col text-right avatar">
				 		{% for user in init.initiators.all %}
				          {% avatar user 40 %}
				        {% endfor %}
				 	</div>
				</div>
			</div>
	  	</div>
	</div>
	{% empty %}
	<div class="card">
		<div class="card-block">
			<em>Keine Initiativen gefunden, die Deiner Suche entsprechen.</em>
		</div>
	</div>
	{% endfor %}
</div>

{% endblock %}

{% block body-javascript %}

{{ block.super }}

<script type="text/javascript">
  	$(function(){
  		var submitTimeout = null;
	    $('.typefilter input').change(function(item) {
	    	if (submitTimeout) window.clearTimeout(submitTimeout);
	    	submitTimeout = window.setTimeout(function() {
	    		$("#filters").submit();
	    	}, 900);

	    });	
  	});
</script>
{% endblock %}
